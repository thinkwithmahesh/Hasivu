# HASIVU Platform - Staging Environment Configuration
# DO NOT COMMIT THIS FILE TO VERSION CONTROL
# Use AWS Secrets Manager and Parameter Store for sensitive values

# =====================================================
# APPLICATION ENVIRONMENT
# =====================================================
NODE_ENV=staging
LOG_LEVEL=debug
API_VERSION=v1

# =====================================================
# AWS CONFIGURATION
# =====================================================
AWS_REGION=ap-south-1
AWS_ACCOUNT_ID=${AWS_ACCOUNT_ID}

# =====================================================
# DATABASE CONFIGURATION (Use RDS Proxy in staging)
# =====================================================
DATABASE_URL=${ssm:/hasivu-platform/staging/database/url}
DATABASE_POOL_MIN=1
DATABASE_POOL_MAX=5
DATABASE_CONNECTION_TIMEOUT=30000
DATABASE_IDLE_TIMEOUT=300000

# =====================================================
# REDIS CONFIGURATION
# =====================================================
REDIS_URL=${ssm:/hasivu-platform/staging/redis/url}
REDIS_POOL_MIN=1
REDIS_POOL_MAX=5
REDIS_CONNECTION_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=3000
REDIS_TTL_DEFAULT=3600

# =====================================================
# COGNITO CONFIGURATION
# =====================================================
COGNITO_USER_POOL_ID=${cf:hasivu-infrastructure-staging.CognitoUserPoolId}
COGNITO_CLIENT_ID=${cf:hasivu-infrastructure-staging.CognitoClientId}
COGNITO_REGION=${AWS_REGION}

# =====================================================
# S3 CONFIGURATION
# =====================================================
S3_BUCKET_NAME=${cf:hasivu-infrastructure-staging.S3BucketName}
S3_REGION=${AWS_REGION}
S3_MAX_FILE_SIZE=10485760
S3_ALLOWED_MIME_TYPES=image/jpeg,image/png,image/gif,image/webp,application/pdf,text/csv
S3_SIGNED_URL_EXPIRY=3600

# =====================================================
# SECRETS MANAGER CONFIGURATION
# =====================================================
RAZORPAY_SECRET_ARN=${cf:hasivu-infrastructure-staging.RazorpaySecretArn}
WHATSAPP_SECRET_ARN=${cf:hasivu-infrastructure-staging.WhatsAppSecretArn}
JWT_SECRET_ARN=${cf:hasivu-infrastructure-staging.JwtSecretArn}

# =====================================================
# EXTERNAL SERVICE URLS
# =====================================================
FRONTEND_URL=https://app-staging.hasivu.com
ADMIN_URL=https://admin-staging.hasivu.com
API_URL=https://api-staging.hasivu.com

# =====================================================
# CORS CONFIGURATION
# =====================================================
CORS_ALLOWED_ORIGINS=https://app-staging.hasivu.com,https://admin-staging.hasivu.com,http://localhost:3000,http://localhost:3001
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Requested-With,X-Api-Key
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400

# =====================================================
# RATE LIMITING (More lenient for testing)
# =====================================================
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=200
RATE_LIMIT_SKIP_FAILED_REQUESTS=true
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# =====================================================
# SECURITY CONFIGURATION
# =====================================================
JWT_EXPIRY=1h
JWT_REFRESH_EXPIRY=30d
PASSWORD_SALT_ROUNDS=10
SESSION_TIMEOUT=3600
MAX_LOGIN_ATTEMPTS=10
ACCOUNT_LOCKOUT_DURATION=300

# =====================================================
# EMAIL CONFIGURATION (SES)
# =====================================================
EMAIL_FROM=staging-noreply@hasivu.com
EMAIL_FROM_NAME=HASIVU Platform (Staging)
EMAIL_REGION=${AWS_REGION}
EMAIL_TEMPLATE_BUCKET=${cf:hasivu-infrastructure-staging.S3BucketName}

# =====================================================
# NOTIFICATION CONFIGURATION
# =====================================================
NOTIFICATION_BATCH_SIZE=50
NOTIFICATION_RETRY_ATTEMPTS=2
NOTIFICATION_RETRY_DELAY=3000
WHATSAPP_WEBHOOK_VERIFY_TOKEN=${ssm:/hasivu-platform/staging/whatsapp/webhook-token}

# =====================================================
# PAYMENT CONFIGURATION (Test mode)
# =====================================================
RAZORPAY_WEBHOOK_SECRET=${ssm:/hasivu-platform/staging/razorpay/webhook-secret}
PAYMENT_ORDER_EXPIRY=1800
PAYMENT_CURRENCY=INR
PAYMENT_MIN_AMOUNT=100

# =====================================================
# MONITORING AND OBSERVABILITY
# =====================================================
X_RAY_TRACING=true
POWERTOOLS_SERVICE_NAME=hasivu-platform-api-staging
POWERTOOLS_METRICS_NAMESPACE=HASIVU/Platform/Staging
POWERTOOLS_LOGGER_LOG_EVENT=true
POWERTOOLS_LOGGER_SAMPLE_RATE=0.5

# =====================================================
# PERFORMANCE CONFIGURATION (Smaller limits for staging)
# =====================================================
MAX_CONCURRENT_CONNECTIONS=100
LAMBDA_MEMORY_SIZE=512
LAMBDA_TIMEOUT=30
LAMBDA_RESERVED_CONCURRENCY=10

# =====================================================
# FEATURE FLAGS (Enable all features for testing)
# =====================================================
FEATURE_FLAG_PAYMENT_INTEGRATION=true
FEATURE_FLAG_WHATSAPP_NOTIFICATIONS=true
FEATURE_FLAG_RFID_VERIFICATION=true
FEATURE_FLAG_ANALYTICS_DASHBOARD=true
FEATURE_FLAG_BULK_OPERATIONS=true
FEATURE_FLAG_REAL_TIME_UPDATES=true

# =====================================================
# BUSINESS CONFIGURATION
# =====================================================
SCHOOL_TIMEZONE=Asia/Kolkata
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,hi,kn
BUSINESS_HOURS_START=06:00
BUSINESS_HOURS_END=18:00
MAX_CHILDREN_PER_PARENT=10
MAX_ORDERS_PER_DAY=10
ORDER_CANCELLATION_WINDOW=3600

# =====================================================
# ANALYTICS CONFIGURATION
# =====================================================
ANALYTICS_ENABLED=true
ANALYTICS_BATCH_SIZE=100
ANALYTICS_FLUSH_INTERVAL=60000
ANALYTICS_RETENTION_DAYS=30

# =====================================================
# BACKUP CONFIGURATION (Disabled for staging)
# =====================================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 3 * * *
BACKUP_RETENTION_DAYS=7
BACKUP_BUCKET=${S3_BUCKET_NAME}/backups

# =====================================================
# HEALTH CHECK CONFIGURATION
# =====================================================
HEALTH_CHECK_TIMEOUT=3000
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_S3=true
HEALTH_CHECK_EXTERNAL_SERVICES=false

# =====================================================
# DEBUGGING (Enabled in staging)
# =====================================================
DEBUG=true
VERBOSE_LOGGING=true
SQL_LOGGING=false
REDIS_LOGGING=false