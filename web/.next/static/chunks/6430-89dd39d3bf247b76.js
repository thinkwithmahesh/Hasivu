"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6430],{6430:function(e,r,t){t.d(r,{P:function(){return c},Q:function(){return a}});var s=t(45610),n=t(86335),o=t(50044),a=function(){function e(){(0,n._)(this,e),this.refreshPromise=null,this.baseUrl="http://localhost:3000/api"}var r=e.prototype;return r.login=function(e){var r=this;return(0,s._)(function(){var t,s,n;return(0,o.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,fetch("".concat(r.baseUrl,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:if((t=o.sent()).ok)return[3,3];return[4,t.json()];case 2:throw Error(o.sent().message||"Login failed");case 3:return[4,t.json()];case 4:return[2,{user:(s=o.sent()).user,tokens:s.tokens,success:!0}];case 5:throw console.error("Login error:",n=o.sent()),n;case 6:return[2]}})})()},r.register=function(e){var r=this;return(0,s._)(function(){var t,s,n;return(0,o.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,fetch("".concat(r.baseUrl,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:if((t=o.sent()).ok)return[3,3];return[4,t.json()];case 2:throw Error(o.sent().message||"Registration failed");case 3:return[4,t.json()];case 4:return[2,{user:(s=o.sent()).user,tokens:s.tokens,success:!0}];case 5:throw console.error("Registration error:",n=o.sent()),n;case 6:return[2]}})})()},r.logout=function(){var e=this;return(0,s._)(function(){var r;return(0,o.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,3,,4]),!(r=e.getAccessToken()))return[3,2];return[4,fetch("".concat(e.baseUrl,"/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(r)}})];case 1:t.sent(),t.label=2;case 2:return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),[3,4];case 3:return console.error("Logout error:",t.sent()),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),[3,4];case 4:return[2]}})})()},r.refreshToken=function(){var e=this;return(0,s._)(function(){return(0,o.Jh)(this,function(r){switch(r.label){case 0:if(e.refreshPromise)return[2,e.refreshPromise];e.refreshPromise=e._refreshToken(),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,e.refreshPromise];case 2:return[2,r.sent()];case 3:return e.refreshPromise=null,[7];case 4:return[2]}})})()},r._refreshToken=function(){var e=this;return(0,s._)(function(){var r,t,s,n;return(0,o.Jh)(this,function(o){switch(o.label){case 0:if(!(r=e.getRefreshToken()))throw Error("No refresh token available");o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch("".concat(e.baseUrl,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:r})})];case 2:if(!(t=o.sent()).ok)throw Error("Token refresh failed");return[4,t.json()];case 3:return s=o.sent(),localStorage.setItem("accessToken",s.accessToken),localStorage.setItem("refreshToken",s.refreshToken),[2,s];case 4:throw n=o.sent(),e.clearTokens(),n;case 5:return[2]}})})()},r.getCurrentUser=function(){var e=this;return(0,s._)(function(){var r,t,s;return(0,o.Jh)(this,function(n){switch(n.label){case 0:if(n.trys.push([0,6,,7]),!(r=e.getAccessToken()))throw Error("No access token available");return[4,fetch("".concat(e.baseUrl,"/auth/me"),{headers:{Authorization:"Bearer ".concat(r)}})];case 1:if((t=n.sent()).ok)return[3,4];if(401!==t.status)return[3,3];return[4,e.refreshToken()];case 2:return n.sent(),[2,e.getCurrentUser()];case 3:throw Error("Failed to get user profile");case 4:return[4,t.json()];case 5:return[2,n.sent()];case 6:throw console.error("Get current user error:",s=n.sent()),s;case 7:return[2]}})})()},r.requestPasswordReset=function(e){var r=this;return(0,s._)(function(){var t,s;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,fetch("".concat(r.baseUrl,"/auth/forgot-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:if((t=n.sent()).ok)return[3,3];return[4,t.json()];case 2:throw Error(n.sent().message||"Password reset request failed");case 3:return[3,5];case 4:throw console.error("Password reset request error:",s=n.sent()),s;case 5:return[2]}})})()},r.confirmPasswordReset=function(e){var r=this;return(0,s._)(function(){var t,s;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,fetch("".concat(r.baseUrl,"/auth/reset-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:if((t=n.sent()).ok)return[3,3];return[4,t.json()];case 2:throw Error(n.sent().message||"Password reset failed");case 3:return[3,5];case 4:throw console.error("Password reset confirm error:",s=n.sent()),s;case 5:return[2]}})})()},r.verifyEmail=function(e){var r=this;return(0,s._)(function(){var t,s;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,fetch("".concat(r.baseUrl,"/auth/verify-email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})})];case 1:if((t=n.sent()).ok)return[3,3];return[4,t.json()];case 2:throw Error(n.sent().message||"Email verification failed");case 3:return[3,5];case 4:throw console.error("Email verification error:",s=n.sent()),s;case 5:return[2]}})})()},r.isAuthenticated=function(){var e=this.getAccessToken();if(!e)return!1;try{var r=JSON.parse(atob(e.split(".")[1])),t=Date.now()/1e3;return r.exp>t}catch(e){return!1}},r.getAccessToken=function(){return localStorage.getItem("accessToken")},r.getRefreshToken=function(){return localStorage.getItem("refreshToken")},r.setTokens=function(e){localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken)},r.clearTokens=function(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user")},r.getStoredUser=function(){var e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},r.setStoredUser=function(e){localStorage.setItem("user",JSON.stringify(e))},e}(),c=new a}}]);