"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6755],{26755:function(e,r,s){s.r(r),s.d(r,{AuthProvider:function(){return m},useAuth:function(){return g},useRoleGuard:function(){return p},withAuth:function(){return A}});var t=s(45610),n=s(41369),u=s(43654),i=s(97142),a=s(50044),c=s(57437),o=s(2265),l=s(24033),f=s(5925),d=s(6430),h=(0,o.createContext)(void 0);function m(e){var r,s,m,g,A,p,w=e.children,_=(0,i._)((0,o.useState)({user:null,isAuthenticated:!1,isLoading:!0,isInitialized:!1}),2),b=_[0],v=_[1],P=(0,l.useRouter)(),y=new d.Q;(0,o.useEffect)(function(){var e;(e=(0,t._)(function(){var e;return(0,a.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),v(function(e){return(0,u._)((0,n._)({},e),{isLoading:!0})}),[4,y.checkAuth()];case 1:return(e=r.sent()).authenticated&&e.user?v({user:e.user,isAuthenticated:!0,isLoading:!1,isInitialized:!0}):v({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0}),[3,3];case 2:return r.sent(),v({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0}),[3,3];case 3:return[2]}})}),function(){return e.apply(this,arguments)})()},[]);var L=(0,o.useCallback)((r=(0,t._)(function(e){var r,s,t;return(0,a.Jh)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),v(function(e){return(0,u._)((0,n._)({},e),{isLoading:!0})}),[4,y.login(e)];case 1:if((r=i.sent()).success&&r.user)return v({user:r.user,isAuthenticated:!0,isLoading:!1,isInitialized:!0}),f.Am.success("Welcome back, ".concat(r.user.firstName,"!")),[2,!0];return f.Am.error(r.error||"Login failed"),[2,!1];case 2:return t=(s=i.sent())instanceof Error?s.message:"Login failed",f.Am.error(t),[2,!1];case 3:return v(function(e){return(0,u._)((0,n._)({},e),{isLoading:!1})}),[7];case 4:return[2]}})}),function(e){return r.apply(this,arguments)}),[]),k=(0,o.useCallback)((s=(0,t._)(function(e){var r,s,t;return(0,a.Jh)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,3,4]),v(function(e){return(0,u._)((0,n._)({},e),{isLoading:!0})}),[4,y.register((0,u._)((0,n._)({},e),{passwordConfirm:e.password}))];case 1:if((r=i.sent()).success&&r.user)return v({user:r.user,isAuthenticated:!0,isLoading:!1,isInitialized:!0}),f.Am.success("Welcome, ".concat(r.user.firstName,"!")),[2,!0];return f.Am.error(r.error||"Registration failed"),[2,!1];case 2:return t=(s=i.sent())instanceof Error?s.message:"Registration failed",f.Am.error(t),[2,!1];case 3:return v(function(e){return(0,u._)((0,n._)({},e),{isLoading:!1})}),[7];case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),[]),C=(0,o.useCallback)((0,t._)(function(){return(0,a.Jh)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,y.logout()];case 1:return e.sent(),v({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0}),f.Am.success("Logged out successfully"),P.push("/"),[3,3];case 2:return e.sent(),v({user:null,isAuthenticated:!1,isLoading:!1,isInitialized:!0}),f.Am.success("Logged out"),P.push("/"),[3,3];case 3:return[2]}})}),[P]),E=(0,o.useCallback)((m=(0,t._)(function(e){var r,s,t;return(0,a.Jh)(this,function(i){switch(i.label){case 0:if(!b.user)return f.Am.error("You must be logged in"),[2,!1];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,y.updateProfile(e)];case 2:if((r=i.sent()).success&&r.user)return v(function(e){return(0,u._)((0,n._)({},e),{user:r.user})}),f.Am.success("Profile updated successfully"),[2,!0];return f.Am.error(r.error||"Profile update failed"),[2,!1];case 3:return t=(s=i.sent())instanceof Error?s.message:"Update failed",f.Am.error(t),[2,!1];case 4:return[2]}})}),function(e){return m.apply(this,arguments)}),[b.user]),R=(0,o.useCallback)((g=(0,t._)(function(e){var r,s,t;return(0,a.Jh)(this,function(n){switch(n.label){case 0:if(e.newPassword!==e.newPasswordConfirm)return f.Am.error("Passwords do not match"),[2,!1];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,y.changePassword(e)];case 2:if((r=n.sent()).success)return f.Am.success("Password changed successfully"),[2,!0];return f.Am.error(r.error||"Password change failed"),[2,!1];case 3:return t=(s=n.sent())instanceof Error?s.message:"Password change failed",f.Am.error(t),[2,!1];case 4:return[2]}})}),function(e){return g.apply(this,arguments)}),[]),I=(0,o.useCallback)((0,t._)(function(){var e;return(0,a.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,y.getProfile()];case 1:return(e=r.sent())&&v(function(r){return(0,u._)((0,n._)({},r),{user:e})}),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}})}),[]),J=(0,o.useCallback)((0,t._)(function(){var e;return(0,a.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,y.checkAuth()];case 1:if((e=r.sent()).authenticated&&e.user)return v(function(r){return(0,u._)((0,n._)({},r),{user:e.user,isAuthenticated:!0})}),[2,!0];return[2,!1];case 2:return r.sent(),[2,!1];case 3:return[2]}})}),[]),z=(0,o.useCallback)((A=(0,t._)(function(e){var r,s,t;return(0,a.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,y.forgotPassword(e)];case 1:if((r=n.sent()).success)return f.Am.success("Password reset instructions sent to your email"),[2,!0];return f.Am.error(r.error||"Request failed"),[2,!1];case 2:return t=(s=n.sent())instanceof Error?s.message:"Request failed",f.Am.error(t),[2,!1];case 3:return[2]}})}),function(e){return A.apply(this,arguments)}),[]),x=(0,o.useCallback)((p=(0,t._)(function(e,r,s){var t,n,u;return(0,a.Jh)(this,function(i){switch(i.label){case 0:if(r!==s)return f.Am.error("Passwords do not match"),[2,!1];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,y.resetPassword(e,r,s)];case 2:if((t=i.sent()).success)return f.Am.success("Password reset successful"),[2,!0];return f.Am.error(t.error||"Password reset failed"),[2,!1];case 3:return u=(n=i.sent())instanceof Error?n.message:"Reset failed",f.Am.error(u),[2,!1];case 4:return[2]}})}),function(e,r,s){return p.apply(this,arguments)}),[]),N=(0,o.useCallback)(function(e){if(!b.user)return!1;var r=b.user.role;return Array.isArray(e)?e.includes(r):r===e},[b.user]),j=(0,u._)((0,n._)({},b),{login:L,register:k,logout:C,updateProfile:E,changePassword:R,refreshProfile:I,checkAuth:J,forgotPassword:z,resetPassword:x,hasRole:N});return(0,c.jsx)(h.Provider,{value:j,children:w})}function g(){var e=(0,o.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function A(e){return function(r){var s=g(),t=s.isAuthenticated,u=s.isLoading,i=s.isInitialized,a=(0,l.useRouter)();return((0,o.useEffect)(function(){if(i&&!u&&!t){var e=a.asPath;a.push("/auth/login?redirect=".concat(encodeURIComponent(e)))}},[t,u,i,a]),!i||u)?(0,c.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):t?(0,c.jsx)(e,(0,n._)({},r)):null}}function p(e){var r=g(),s=r.hasRole,t=r.isAuthenticated,n=r.isLoading,u=(0,l.useRouter)();return(0,o.useEffect)(function(){n||!t||s(e)||(f.Am.error("Access denied. Insufficient permissions."),u.push("/dashboard"))},[s,e,t,n,u]),{hasAccess:s(e),isLoading:n}}r.default=h}}]);