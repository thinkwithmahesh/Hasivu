# Story 5.2: Billing and Invoice Management

## Status
Done

## Story

**As a** parent,
**I want** clear billing statements and invoice management,
**so that** I can track my meal expenses and manage my family's food service budget effectively.

## Acceptance Criteria

1. Automated invoice generation with detailed meal breakdown and pricing
2. Monthly billing statements with transaction history and payment summaries
3. Tax calculation and compliance with GST requirements for Indian market
4. Invoice customization with school branding and parent information
5. Digital receipt delivery via email and in-app notification
6. Billing dispute resolution with detailed transaction records
7. Payment history tracking with downloadable statements and reports
8. Integration with accounting systems for school financial management

## Tasks / Subtasks

- [ ] **Task 1: Automated Invoice Generation** (AC: 1)
  - [ ] Create comprehensive invoice generation engine with meal itemization and pricing breakdown
  - [ ] Implement intelligent invoice scheduling with billing cycle management and automatic processing
  - [ ] Setup invoice template system with customizable layouts and branding options
  - [ ] Create invoice numbering with sequential generation and compliance formatting
  - [ ] Implement invoice validation with accuracy checking and error prevention
  - [ ] Add invoice analytics with generation performance and delivery tracking

- [ ] **Task 2: Monthly Billing Statements** (AC: 2)
  - [ ] Create comprehensive billing statement generation with transaction aggregation and summary
  - [ ] Implement billing cycle management with flexible periods and automatic statement generation
  - [ ] Setup payment summary analysis with method breakdown and success rate tracking
  - [ ] Create usage analytics with meal consumption patterns and spending insights
  - [ ] Implement billing comparison with period-over-period analysis and trend identification
  - [ ] Add billing optimization recommendations with cost savings and usage efficiency

- [ ] **Task 3: Tax Calculation and GST Compliance** (AC: 3)
  - [ ] Create comprehensive GST calculation engine with rate management and automatic updates
  - [ ] Implement tax compliance framework with GSTIN validation and regulatory adherence
  - [ ] Setup tax reporting with automated filing support and compliance documentation
  - [ ] Create tax exemption management with educational institution benefits and processing
  - [ ] Implement multi-state tax handling with jurisdiction-specific rates and regulations
  - [ ] Add tax analytics with liability tracking and optimization recommendations

- [ ] **Task 4: Invoice Customization and Branding** (AC: 4)
  - [ ] Create flexible invoice template engine with drag-and-drop customization and branding
  - [ ] Implement school-specific branding with logo integration and color scheme management
  - [ ] Setup parent information customization with address management and contact preferences
  - [ ] Create multi-language invoice support with localization and cultural adaptation
  - [ ] Implement invoice layout optimization with mobile-friendly design and accessibility
  - [ ] Add template analytics with usage tracking and customization insights

- [ ] **Task 5: Digital Receipt and Delivery** (AC: 5)
  - [ ] Create multi-channel receipt delivery with email, SMS, and in-app notification
  - [ ] Implement receipt format optimization with PDF generation and mobile display
  - [ ] Setup delivery confirmation tracking with read receipts and engagement analytics
  - [ ] Create receipt storage and retrieval with cloud integration and search capabilities
  - [ ] Implement receipt sharing with family coordination and expense management
  - [ ] Add delivery analytics with success rates and preference optimization

- [ ] **Task 6: Billing Dispute Resolution** (AC: 6)
  - [ ] Create comprehensive dispute reporting system with structured incident documentation
  - [ ] Implement dispute classification with automated routing and priority assignment
  - [ ] Setup investigation workflow with evidence collection and stakeholder communication
  - [ ] Create resolution tracking with timeline management and outcome documentation
  - [ ] Implement compensation management with credit processing and refund coordination
  - [ ] Add dispute analytics with pattern recognition and prevention strategies

- [ ] **Task 7: Payment History and Reporting** (AC: 7)
  - [ ] Create comprehensive payment history with advanced search and filtering capabilities
  - [ ] Implement downloadable statement generation with multiple format support (PDF, Excel, CSV)
  - [ ] Setup spending analytics with category breakdown and trend analysis
  - [ ] Create budget tracking with goal setting and alert management
  - [ ] Implement expense categorization with automatic classification and manual override
  - [ ] Add financial insights with spending patterns and optimization recommendations

- [ ] **Task 8: Accounting System Integration** (AC: 8)
  - [ ] Create seamless integration with popular accounting software (QuickBooks, Tally, SAP)
  - [ ] Implement automated data synchronization with real-time updates and error handling
  - [ ] Setup chart of accounts mapping with customizable categorization and GL integration
  - [ ] Create reconciliation support with transaction matching and discrepancy resolution
  - [ ] Implement audit trail maintenance with comprehensive logging and compliance support
  - [ ] Add financial reporting with automated generation and distribution

- [ ] **Task 9: Performance and Compliance Optimization** (All ACs)
  - [ ] Create high-performance billing system with optimized processing and scalable architecture
  - [ ] Implement compliance validation with regulatory requirements and audit support
  - [ ] Setup monitoring and alerting with comprehensive system health and error tracking
  - [ ] Create data backup and retention with disaster recovery and compliance adherence
  - [ ] Implement security protocols with data protection and access control
  - [ ] Add performance optimization with caching strategies and processing efficiency

## Dev Notes

### Technical Context from Architecture

**Billing and Invoice Management Models**:
```typescript
interface Invoice {
  id: string;
  invoiceNumber: string;
  parentId: string;
  schoolId: string;
  billingPeriod: BillingPeriod;
  invoiceDate: Date;
  dueDate: Date;
  lineItems: InvoiceLineItem[];
  subtotal: number;
  taxes: TaxBreakdown[];
  discounts: DiscountBreakdown[];
  total: number;
  currency: string;
  status: InvoiceStatus;
  paymentHistory: PaymentRecord[];
  customization: InvoiceCustomization;
  deliveryInfo: DeliveryInfo;
  metadata: InvoiceMetadata;
  createdAt: Date;
  updatedAt: Date;
}

interface InvoiceLineItem {
  id: string;
  orderId: string;
  mealDate: Date;
  studentName: string;
  mealDescription: string;
  quantity: number;
  unitPrice: number;
  subtotal: number;
  taxes: ItemTaxBreakdown[];
  discounts: ItemDiscountBreakdown[];
  total: number;
  nutritionalInfo: NutritionalSummary;
  deliveryStatus: DeliveryStatus;
}

interface BillingStatement {
  id: string;
  statementNumber: string;
  parentId: string;
  schoolId: string;
  statementPeriod: StatementPeriod;
  invoices: InvoiceReference[];
  payments: PaymentSummary[];
  adjustments: BillingAdjustment[];
  openingBalance: number;
  closingBalance: number;
  totalCharges: number;
  totalPayments: number;
  analytics: BillingAnalytics;
  customization: StatementCustomization;
  createdAt: Date;
}

interface TaxCalculationEngine {
  gstRates: GSTRateConfig[];
  taxExemptions: TaxExemption[];
  jurisdictionRules: JurisdictionRule[];
  complianceValidator: ComplianceValidator;
  reportingEngine: TaxReportingEngine;
  auditTrail: TaxAuditTrail;
}
```

**GST and Tax Compliance** [Source: architecture.md#tax-compliance]:
```typescript
interface GSTCompliance {
  gstinValidation: GSTINValidator;
  rateManagement: GSTRateManager;
  returnFiling: GSTReturnEngine;
  invoiceCompliance: GSTInvoiceValidator;
  reportGeneration: GSTReportGenerator;
  auditSupport: GST AuditSupport;
}

interface GSTRateConfig {
  category: string;
  subcategory: string;
  cgstRate: number;
  sgstRate: number;
  igstRate: number;
  effectiveDate: Date;
  exemptionConditions: ExemptionCondition[];
  applicabilityRules: ApplicabilityRule[];
}

interface TaxBreakdown {
  taxType: TaxType;
  taxableAmount: number;
  taxRate: number;
  taxAmount: number;
  exemptionApplied: boolean;
  exemptionReason?: string;
  compliance: ComplianceInfo;
}

interface BillingDispute {
  disputeId: string;
  invoiceId: string;
  parentId: string;
  disputeType: DisputeType;
  amount: number;
  description: string;
  evidence: DisputeEvidence[];
  status: DisputeStatus;
  assignedTo: string;
  resolution: DisputeResolution;
  timeline: DisputeTimeline;
  compensation: DisputeCompensation;
  createdAt: Date;
  resolvedAt?: Date;
}
```

**Invoice Customization and Templates**:
```typescript
interface InvoiceTemplate {
  templateId: string;
  schoolId: string;
  name: string;
  description: string;
  layout: TemplateLayout;
  branding: BrandingConfig;
  styling: StylingConfig;
  fields: TemplateField[];
  localization: LocalizationConfig;
  compliance: TemplateCompliance;
  isActive: boolean;
  version: number;
  createdAt: Date;
  updatedAt: Date;
}

interface BrandingConfig {
  schoolLogo: LogoConfig;
  colorScheme: ColorScheme;
  typography: TypographyConfig;
  headerLayout: HeaderLayout;
  footerLayout: FooterLayout;
  watermark: WatermarkConfig;
}

interface ReceiptDelivery {
  receiptId: string;
  deliveryChannels: DeliveryChannel[];
  deliveryPreferences: DeliveryPreferences;
  deliveryStatus: ChannelDeliveryStatus[];
  deliveryAttempts: DeliveryAttempt[];
  deliveryAnalytics: DeliveryAnalytics;
  retryPolicy: RetryPolicy;
}

interface AccountingIntegration {
  integrationId: string;
  accountingSystem: AccountingSystemType;
  connectionConfig: ConnectionConfig;
  mappingRules: MappingRule[];
  syncSchedule: SyncSchedule;
  reconciliation: ReconciliationConfig;
  auditTrail: IntegrationAuditTrail;
  errorHandling: ErrorHandlingConfig;
}
```

**Financial Analytics and Reporting**:
```typescript
interface BillingAnalytics {
  revenueMetrics: RevenueMetrics;
  paymentMetrics: PaymentMetrics;
  usagePatterns: UsagePattern[];
  trends: BillingTrend[];
  forecasting: RevenueForecast;
  comparisons: PeriodComparison[];
}

interface RevenueMetrics {
  totalRevenue: number;
  averageOrderValue: number;
  revenuePerStudent: number;
  revenueGrowthRate: number;
  seasonalityFactors: SeasonalityFactor[];
  revenueByCategory: CategoryRevenue[];
}

interface PaymentHistory {
  parentId: string;
  transactions: TransactionHistory[];
  statements: StatementHistory[];
  analytics: PaymentAnalytics;
  downloadableReports: ReportConfig[];
  budgetTracking: BudgetTracker;
  insights: FinancialInsight[];
}

interface ComplianceFramework {
  gstCompliance: GSTCompliance;
  auditRequirements: AuditRequirement[];
  dataRetention: DataRetentionPolicy;
  privacyCompliance: PrivacyCompliance;
  financialReporting: FinancialReportingRequirement[];
  regulatoryUpdates: RegulatoryUpdateTracker;
}
```

**Database Schema Extensions**:
```sql
-- Invoice management with comprehensive billing support
CREATE TABLE invoices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    invoice_number VARCHAR(50) NOT NULL UNIQUE,
    parent_id UUID NOT NULL REFERENCES users(id),
    school_id UUID NOT NULL REFERENCES schools(id),
    billing_period JSONB NOT NULL,
    invoice_date DATE NOT NULL,
    due_date DATE NOT NULL,
    line_items JSONB NOT NULL,
    subtotal DECIMAL(10,2) NOT NULL,
    taxes JSONB NOT NULL,
    discounts JSONB DEFAULT '[]',
    total DECIMAL(10,2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'INR',
    status VARCHAR(20) DEFAULT 'draft',
    payment_history JSONB DEFAULT '[]',
    customization JSONB NOT NULL,
    delivery_info JSONB NOT NULL,
    metadata JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Billing statements with monthly aggregation
CREATE TABLE billing_statements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    statement_number VARCHAR(50) NOT NULL UNIQUE,
    parent_id UUID NOT NULL REFERENCES users(id),
    school_id UUID NOT NULL REFERENCES schools(id),
    statement_period JSONB NOT NULL,
    invoice_references JSONB NOT NULL,
    payment_summary JSONB NOT NULL,
    adjustments JSONB DEFAULT '[]',
    opening_balance DECIMAL(10,2) DEFAULT 0,
    closing_balance DECIMAL(10,2) NOT NULL,
    total_charges DECIMAL(10,2) NOT NULL,
    total_payments DECIMAL(10,2) NOT NULL,
    analytics JSONB NOT NULL,
    customization JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tax calculation and GST compliance
CREATE TABLE tax_calculations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    invoice_id UUID NOT NULL REFERENCES invoices(id),
    tax_type VARCHAR(20) NOT NULL,
    taxable_amount DECIMAL(10,2) NOT NULL,
    tax_rate DECIMAL(5,4) NOT NULL,
    tax_amount DECIMAL(10,2) NOT NULL,
    exemption_applied BOOLEAN DEFAULT false,
    exemption_reason TEXT,
    compliance_data JSONB NOT NULL,
    calculation_date TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Invoice templates and customization
CREATE TABLE invoice_templates (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id VARCHAR(50) NOT NULL UNIQUE,
    school_id UUID NOT NULL REFERENCES schools(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    layout JSONB NOT NULL,
    branding JSONB NOT NULL,
    styling JSONB NOT NULL,
    fields JSONB NOT NULL,
    localization JSONB NOT NULL,
    compliance JSONB NOT NULL,
    is_active BOOLEAN DEFAULT true,
    version INTEGER DEFAULT 1,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Billing disputes and resolution tracking
CREATE TABLE billing_disputes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    dispute_id VARCHAR(50) NOT NULL UNIQUE,
    invoice_id UUID NOT NULL REFERENCES invoices(id),
    parent_id UUID NOT NULL REFERENCES users(id),
    dispute_type VARCHAR(50) NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    description TEXT NOT NULL,
    evidence JSONB DEFAULT '[]',
    status VARCHAR(20) DEFAULT 'open',
    assigned_to UUID REFERENCES users(id),
    resolution JSONB,
    timeline JSONB NOT NULL,
    compensation JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    resolved_at TIMESTAMP WITH TIME ZONE
);

-- Receipt delivery tracking
CREATE TABLE receipt_deliveries (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    receipt_id VARCHAR(100) NOT NULL,
    invoice_id UUID NOT NULL REFERENCES invoices(id),
    delivery_channels JSONB NOT NULL,
    delivery_preferences JSONB NOT NULL,
    delivery_status JSONB NOT NULL,
    delivery_attempts JSONB DEFAULT '[]',
    delivery_analytics JSONB NOT NULL,
    retry_policy JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_attempt TIMESTAMP WITH TIME ZONE
);

-- Accounting system integration
CREATE TABLE accounting_integrations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    integration_id VARCHAR(50) NOT NULL UNIQUE,
    school_id UUID NOT NULL REFERENCES schools(id),
    accounting_system VARCHAR(50) NOT NULL,
    connection_config JSONB NOT NULL,
    mapping_rules JSONB NOT NULL,
    sync_schedule JSONB NOT NULL,
    last_sync TIMESTAMP WITH TIME ZONE,
    sync_status VARCHAR(20) DEFAULT 'active',
    error_log JSONB DEFAULT '[]',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Financial analytics and reporting
CREATE TABLE billing_analytics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    metric_type VARCHAR(50) NOT NULL,
    metric_value DECIMAL(12,4) NOT NULL,
    dimensions JSONB NOT NULL,
    timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    aggregation_period VARCHAR(20),
    school_id UUID REFERENCES schools(id),
    parent_id UUID REFERENCES users(id),
    INDEX idx_billing_analytics_type_timestamp(metric_type, timestamp)
);

-- Performance indexes for billing operations
CREATE INDEX idx_invoices_parent_period ON invoices(parent_id, invoice_date);
CREATE INDEX idx_invoices_school_status ON invoices(school_id, status);
CREATE INDEX idx_billing_statements_parent_period ON billing_statements(parent_id, statement_period);
CREATE INDEX idx_tax_calculations_invoice ON tax_calculations(invoice_id);
CREATE INDEX idx_billing_disputes_status ON billing_disputes(status);
CREATE INDEX idx_receipt_deliveries_invoice ON receipt_deliveries(invoice_id);
```

**API Endpoints** [Source: architecture.md#rest-api-specification]:
- **POST /billing/invoices**: Generate invoice for billing period
- **GET /parents/{parentId}/invoices**: Get invoice history with filtering
- **GET /invoices/{invoiceId}**: Get detailed invoice information
- **POST /invoices/{invoiceId}/deliver**: Send invoice via preferred channels
- **GET /parents/{parentId}/statements**: Get billing statements
- **POST /billing/disputes**: Report billing dispute or discrepancy
- **GET /billing/templates**: Get available invoice templates
- **POST /billing/templates**: Create custom invoice template
- **GET /billing/analytics**: Get billing performance analytics
- **POST /billing/accounting/sync**: Sync with accounting system

### File Structure Context

**Billing and Invoice Components** [Source: architecture.md#unified-project-structure]:
```
apps/mobile/src/
├── screens/billing/
│   ├── InvoicesScreen.tsx            # Invoice management and history
│   ├── BillingStatementsScreen.tsx   # Monthly billing statements
│   ├── PaymentHistoryScreen.tsx      # Transaction history and tracking
│   ├── DisputeReportingScreen.tsx    # Billing dispute interface
│   ├── BudgetTrackingScreen.tsx      # Budget management and insights
│   └── TaxDocumentsScreen.tsx        # Tax receipts and compliance
├── components/billing/
│   ├── InvoiceCard.tsx               # Invoice display and summary
│   ├── BillingStatement.tsx          # Statement visualization
│   ├── PaymentHistoryTable.tsx      # Payment transaction display
│   ├── TaxBreakdown.tsx              # Tax calculation display
│   ├── DisputeForm.tsx               # Dispute reporting form
│   ├── BudgetTracker.tsx             # Budget tracking interface
│   ├── ExpenseAnalytics.tsx          # Spending insights and analytics
│   └── ReceiptViewer.tsx             # Digital receipt display
├── hooks/billing/
│   ├── useInvoices.tsx               # Invoice management
│   ├── useBillingStatements.tsx      # Statement generation and display
│   ├── usePaymentHistory.tsx         # Payment tracking and analytics
│   ├── useTaxCalculation.tsx         # Tax computation and compliance
│   ├── useDisputeResolution.tsx      # Dispute management
│   ├── useBudgetTracking.tsx         # Budget monitoring and alerts
│   └── useBillingAnalytics.tsx       # Financial insights and reporting
└── services/
    ├── invoiceService.ts             # Invoice generation and management
    ├── billingService.ts             # Billing statement processing
    ├── taxService.ts                 # Tax calculation and compliance
    ├── disputeService.ts             # Dispute resolution workflows
    ├── receiptService.ts             # Receipt delivery and tracking
    └── analyticsService.ts           # Financial analytics and insights
```

**Backend Integration** [Source: architecture.md#unified-project-structure]:
```
apps/api/src/
├── functions/billing/
│   ├── generateInvoice.ts            # Invoice generation and processing
│   ├── processBillingStatement.ts    # Monthly statement generation
│   ├── calculateTaxes.ts             # GST and tax calculation
│   ├── deliverReceipts.ts            # Multi-channel receipt delivery
│   ├── processDispute.ts             # Billing dispute workflow
│   ├── generateReports.ts            # Financial reporting and analytics
│   ├── syncAccounting.ts             # Accounting system integration
│   └── validateCompliance.ts         # Regulatory compliance validation
├── services/
│   ├── invoiceGenerationService.ts   # Core invoice processing
│   ├── billingStatementService.ts    # Statement aggregation and analysis
│   ├── taxCalculationService.ts      # Comprehensive tax computation
│   ├── receiptDeliveryService.ts     # Multi-channel delivery orchestration
│   ├── disputeResolutionService.ts   # Dispute workflow management
│   ├── accountingIntegrationService.ts # External system synchronization
│   ├── complianceService.ts          # Regulatory compliance management
│   └── billingAnalyticsService.ts    # Financial analytics and insights
└── repositories/
    ├── invoiceRepository.ts          # Invoice data access and storage
    ├── statementRepository.ts        # Billing statement management
    ├── taxRepository.ts              # Tax calculation and audit data
    ├── receiptRepository.ts          # Receipt delivery tracking
    ├── disputeRepository.ts          # Dispute tracking and resolution
    ├── templateRepository.ts         # Invoice template management
    └── analyticsRepository.ts        # Financial analytics data storage
```

### Business Logic Requirements

**Automated Billing Intelligence**:
- Smart billing cycle detection with school calendar integration and holiday adjustments
- Intelligent invoice consolidation with family coordination and spending optimization
- Automated billing schedule with payment reminder and notification optimization
- Dynamic pricing integration with promotional discounts and loyalty program benefits

**Tax Compliance Excellence**:
- Real-time GST rate updates with automatic calculation and compliance validation
- Multi-state tax jurisdiction handling with location-based rate application
- Educational institution tax exemption processing with automatic benefit application
- Comprehensive audit trail with regulatory compliance and documentation requirements

**Financial Analytics and Insights**:
- Intelligent spending pattern analysis with budget optimization recommendations
- Family financial planning with goal setting and achievement tracking
- Comparative analysis with peer benchmarking and industry insights
- Predictive analytics with seasonal trend forecasting and budget planning

**Integration and Automation**:
- Seamless accounting system integration with automated data synchronization
- Payment gateway coordination with transaction reconciliation and error handling
- School financial dashboard integration with revenue tracking and reporting
- Parent financial management with budget alerts and spending optimization

### Previous Story Dependencies

**Dependencies from Story 5.1**:
- **Payment Gateway Integration**: Transaction data for invoice generation and billing
- **Payment Processing**: Payment confirmation for billing statement accuracy
- **Multi-currency Support**: Currency conversion for international billing

**Dependencies from Epic 1**:
- **Story 1.2**: Authentication system for secure billing access and financial data protection
- **Story 1.3**: User management for parent billing association and family coordination
- **Story 1.4**: API Gateway for secure billing communication and transaction processing

**Dependencies from Epic 2**:
- **Story 2.1**: Product catalog for meal pricing and billing amount calculation
- **Story 2.2**: Menu planning for billing cycle coordination and subscription management
- **Story 2.3**: Nutritional information for value-based billing and premium service pricing

**Dependencies from Epic 3**:
- **Order Management**: Order data for invoice line item generation and billing accuracy
- **Shopping Cart**: Order totals and pricing for billing calculation and invoice generation
- **Checkout Process**: Order confirmation for billing trigger and invoice creation

**Dependencies from Epic 4**:
- **RFID Delivery Verification**: Delivery confirmation for billing accuracy and dispute resolution
- **Order Tracking**: Order completion status for billing trigger and invoice processing

### Integration Points

**Payment System Integration**:
- Real-time payment processing with invoice settlement and automatic reconciliation
- Payment method coordination with billing preference management and optimization
- Refund processing integration with invoice adjustment and credit management
- Payment analytics coordination with billing insights and financial reporting

**Order Management Integration**:
- Seamless order-to-invoice conversion with meal detail inclusion and pricing accuracy
- Order modification handling with billing adjustment and proration calculation
- Delivery verification integration with billing confirmation and dispute prevention
- Subscription order coordination with recurring billing and payment automation

**School Administration Integration**:
- Financial dashboard integration with revenue tracking and performance analytics
- Accounting system synchronization with automated data export and reconciliation
- Compliance reporting with regulatory submission and audit trail management
- Revenue optimization with pricing strategy and financial planning support

**Future Epic Integration**:
- Subscription service integration with automated recurring billing and payment processing
- Analytics system for comprehensive financial insights and optimization recommendations
- Loyalty program integration with billing-based rewards and benefit calculation
- Notification system for billing alerts and payment reminder automation

## Testing

### Testing Standards
- **Location**: Billing tests in `apps/mobile/__tests__/screens/billing/` and `apps/api/__tests__/functions/billing/`
- **Frameworks**: Jest with React Native Testing Library, Supertest for API testing
- **Coverage**: 100% coverage for tax calculations and billing accuracy
- **Compliance Testing**: GST compliance validation and regulatory requirement verification

### Specific Test Requirements
- **Unit Tests**: All billing services, tax calculations, invoice generation
- **Integration Tests**: Complete billing workflows, accounting integration, payment coordination
- **Compliance Tests**: GST validation, audit trail verification, regulatory compliance
- **Performance Tests**: High-volume billing processing, statement generation, analytics
- **Security Tests**: Financial data protection, access control, audit logging

### Test Scenarios
1. **Invoice Generation**: Automated creation, line item accuracy, tax calculation
2. **Billing Statements**: Monthly aggregation, payment summary, analytics generation
3. **Tax Compliance**: GST calculation, exemption processing, audit trail validation
4. **Template Customization**: Branding application, layout generation, localization
5. **Receipt Delivery**: Multi-channel delivery, tracking, engagement analytics
6. **Dispute Resolution**: Issue reporting, investigation workflow, resolution tracking
7. **Payment History**: Transaction tracking, statement generation, downloadable reports
8. **Accounting Integration**: Data synchronization, reconciliation, error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-02 | 1.0 | Initial story creation with comprehensive billing and invoice management context | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be populated during development*

### Debug Log References
*To be populated during development*

### Completion Notes List
*To be populated during development*

### File List
*To be populated during development*

## QA Results

*Results from QA Agent review will be populated here after story implementation*