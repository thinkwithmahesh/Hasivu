# HASIVU Platform - Terraform Outputs
# Output values for AWS infrastructure deployment
# Generated by SuperClaude Wave 1: Infrastructure Foundation

# =====================================================
# NETWORKING OUTPUTS
# =====================================================

output "vpc_id" {
  description = "ID of the VPC"
  value       = aws_vpc.main.id
}

output "vpc_cidr_block" {
  description = "CIDR block of the VPC"
  value       = aws_vpc.main.cidr_block
}

output "public_subnet_ids" {
  description = "IDs of the public subnets"
  value       = aws_subnet.public[*].id
}

output "private_subnet_ids" {
  description = "IDs of the private subnets"
  value       = aws_subnet.private[*].id
}

output "database_subnet_ids" {
  description = "IDs of the database subnets"
  value       = aws_subnet.database[*].id
}

output "internet_gateway_id" {
  description = "ID of the Internet Gateway"
  value       = aws_internet_gateway.main.id
}

output "nat_gateway_ids" {
  description = "IDs of the NAT Gateways"
  value       = aws_nat_gateway.main[*].id
}

# =====================================================
# SECURITY GROUP OUTPUTS
# =====================================================

output "alb_security_group_id" {
  description = "ID of the ALB security group"
  value       = aws_security_group.alb.id
}

output "ecs_security_group_id" {
  description = "ID of the ECS security group"
  value       = aws_security_group.ecs_service.id
}

output "rds_security_group_id" {
  description = "ID of the RDS security group"
  value       = aws_security_group.rds.id
}

output "redis_security_group_id" {
  description = "ID of the Redis security group"
  value       = aws_security_group.redis.id
}

# =====================================================
# DATABASE OUTPUTS
# =====================================================

output "rds_instance_id" {
  description = "ID of the RDS instance"
  value       = aws_db_instance.main.id
}

output "rds_endpoint" {
  description = "RDS instance endpoint"
  value       = aws_db_instance.main.endpoint
  sensitive   = true
}

output "rds_port" {
  description = "RDS instance port"
  value       = aws_db_instance.main.port
}

output "database_name" {
  description = "Name of the database"
  value       = aws_db_instance.main.db_name
}

output "database_username" {
  description = "Database master username"
  value       = aws_db_instance.main.username
  sensitive   = true
}

output "rds_subnet_group_name" {
  description = "Name of the RDS subnet group"
  value       = aws_db_subnet_group.main.name
}

output "rds_parameter_group_name" {
  description = "Name of the RDS parameter group"
  value       = aws_db_parameter_group.main.name
}

# =====================================================
# REDIS OUTPUTS
# =====================================================

output "redis_replication_group_id" {
  description = "ID of the Redis replication group"
  value       = aws_elasticache_replication_group.main.replication_group_id
}

output "redis_primary_endpoint" {
  description = "Redis primary endpoint"
  value       = aws_elasticache_replication_group.main.primary_endpoint_address
  sensitive   = true
}

output "redis_port" {
  description = "Redis port"
  value       = aws_elasticache_replication_group.main.port
}

output "redis_subnet_group_name" {
  description = "Name of the Redis subnet group"
  value       = aws_elasticache_subnet_group.main.name
}

# =====================================================
# CONTAINER INFRASTRUCTURE OUTPUTS
# =====================================================

output "ecs_cluster_id" {
  description = "ID of the ECS cluster"
  value       = aws_ecs_cluster.main.id
}

output "ecs_cluster_name" {
  description = "Name of the ECS cluster"
  value       = aws_ecs_cluster.main.name
}

output "ecs_cluster_arn" {
  description = "ARN of the ECS cluster"
  value       = aws_ecs_cluster.main.arn
}

output "cloudwatch_log_group_name" {
  description = "Name of the CloudWatch log group for ECS"
  value       = aws_cloudwatch_log_group.ecs.name
}

# =====================================================
# LOAD BALANCER OUTPUTS
# =====================================================

output "alb_id" {
  description = "ID of the Application Load Balancer"
  value       = aws_lb.main.id
}

output "alb_arn" {
  description = "ARN of the Application Load Balancer"
  value       = aws_lb.main.arn
}

output "alb_dns_name" {
  description = "DNS name of the Application Load Balancer"
  value       = aws_lb.main.dns_name
}

output "alb_zone_id" {
  description = "Zone ID of the Application Load Balancer"
  value       = aws_lb.main.zone_id
}

output "alb_logs_bucket" {
  description = "S3 bucket for ALB access logs"
  value       = aws_s3_bucket.alb_logs.bucket
}

# =====================================================
# IAM OUTPUTS
# =====================================================

output "ecs_task_execution_role_arn" {
  description = "ARN of the ECS task execution role"
  value       = aws_iam_role.ecs_task_execution.arn
}

output "ecs_task_role_arn" {
  description = "ARN of the ECS task role"
  value       = aws_iam_role.ecs_task.arn
}

output "rds_monitoring_role_arn" {
  description = "ARN of the RDS monitoring role"
  value       = aws_iam_role.rds_monitoring.arn
}

# =====================================================
# SECRETS MANAGEMENT OUTPUTS
# =====================================================

output "database_secret_arn" {
  description = "ARN of the database secret"
  value       = aws_secretsmanager_secret.database.arn
  sensitive   = true
}

output "redis_secret_arn" {
  description = "ARN of the Redis secret"
  value       = aws_secretsmanager_secret.redis.arn
  sensitive   = true
}

# =====================================================
# STORAGE OUTPUTS
# =====================================================

output "app_files_bucket" {
  description = "S3 bucket for application files"
  value       = aws_s3_bucket.app_files.bucket
}

output "app_files_bucket_arn" {
  description = "ARN of the S3 bucket for application files"
  value       = aws_s3_bucket.app_files.arn
}

output "app_files_bucket_domain_name" {
  description = "Domain name of the S3 bucket for application files"
  value       = aws_s3_bucket.app_files.bucket_domain_name
}

# =====================================================
# MONITORING OUTPUTS
# =====================================================

output "sns_alerts_topic_arn" {
  description = "ARN of the SNS topic for alerts"
  value       = aws_sns_topic.alerts.arn
}

output "rds_cpu_alarm_arn" {
  description = "ARN of the RDS CPU alarm"
  value       = aws_cloudwatch_metric_alarm.rds_cpu.arn
}

# =====================================================
# APPLICATION CONFIGURATION OUTPUTS
# =====================================================

output "application_url" {
  description = "URL to access the application"
  value       = var.domain_name != "" ? "https://${var.domain_name}" : "http://${aws_lb.main.dns_name}"
}

output "environment" {
  description = "Environment name"
  value       = var.environment
}

output "aws_region" {
  description = "AWS region"
  value       = var.aws_region
}

output "project_name" {
  description = "Project name"
  value       = var.project_name
}

# =====================================================
# CONNECTION STRINGS (FOR APPLICATION DEPLOYMENT)
# =====================================================

output "database_connection_info" {
  description = "Database connection information for application deployment"
  value = {
    host               = aws_db_instance.main.address
    port               = aws_db_instance.main.port
    database           = aws_db_instance.main.db_name
    username           = aws_db_instance.main.username
    secret_arn         = aws_secretsmanager_secret.database.arn
    parameter_group    = aws_db_parameter_group.main.name
    subnet_group       = aws_db_subnet_group.main.name
    security_group_id  = aws_security_group.rds.id
  }
  sensitive = true
}

output "redis_connection_info" {
  description = "Redis connection information for application deployment"
  value = {
    host              = aws_elasticache_replication_group.main.primary_endpoint_address
    port              = aws_elasticache_replication_group.main.port
    secret_arn        = aws_secretsmanager_secret.redis.arn
    subnet_group      = aws_elasticache_subnet_group.main.name
    security_group_id = aws_security_group.redis.id
  }
  sensitive = true
}

output "container_environment_variables" {
  description = "Environment variables for container deployment"
  value = {
    AWS_REGION                = var.aws_region
    ENVIRONMENT              = var.environment
    PROJECT_NAME             = var.project_name
    DATABASE_SECRET_ARN      = aws_secretsmanager_secret.database.arn
    REDIS_SECRET_ARN         = aws_secretsmanager_secret.redis.arn
    S3_BUCKET_NAME          = aws_s3_bucket.app_files.bucket
    CLOUDWATCH_LOG_GROUP    = aws_cloudwatch_log_group.ecs.name
    SNS_ALERTS_TOPIC_ARN    = aws_sns_topic.alerts.arn
  }
  sensitive = true
}

# =====================================================
# DEPLOYMENT INFORMATION
# =====================================================

output "deployment_info" {
  description = "Information needed for application deployment"
  value = {
    cluster_name           = aws_ecs_cluster.main.name
    target_group_arn      = aws_lb.main.arn
    subnet_ids            = aws_subnet.private[*].id
    security_group_id     = aws_security_group.ecs_service.id
    task_execution_role   = aws_iam_role.ecs_task_execution.arn
    task_role             = aws_iam_role.ecs_task.arn
    log_group             = aws_cloudwatch_log_group.ecs.name
  }
}

# =====================================================
# RESOURCE SUMMARY
# =====================================================

output "resource_summary" {
  description = "Summary of created resources"
  value = {
    vpc_id                = aws_vpc.main.id
    public_subnets_count  = length(aws_subnet.public)
    private_subnets_count = length(aws_subnet.private)
    database_subnets_count = length(aws_subnet.database)
    rds_instance_class    = aws_db_instance.main.instance_class
    redis_node_type       = aws_elasticache_replication_group.main.node_type
    ecs_cluster_name      = aws_ecs_cluster.main.name
    alb_dns_name         = aws_lb.main.dns_name
    s3_buckets_created   = [aws_s3_bucket.app_files.bucket, aws_s3_bucket.alb_logs.bucket]
    secrets_created      = [aws_secretsmanager_secret.database.name, aws_secretsmanager_secret.redis.name]
  }
}